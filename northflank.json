{
  "apiVersion": "v1.2",
  "spec": {
    "kind": "Workflow",
    "spec": {
      "type": "sequential",
      "steps": [
        {
          "kind": "Project",
          "ref": "project",
          "spec": {
            "name": "harvest-mcp",
            "color": "#57637A",
            "networking": {
              "tailscale": {
                "authKeyTags": [],
                "enabled": false
              },
              "allowedIngressProjects": []
            },
            "clusterId": "tiny-cluster"
          }
        },
        {
          "kind": "Workflow",
          "spec": {
            "type": "sequential",
            "context": {
              "projectId": "${refs.project.id}"
            },
            "steps": [
              {
                "kind": "SecretInheritance",
                "spec": {
                  "secrets": [
                    "harvest-mcp-prd"
                  ]
                },
                "ref": "harvest-mcp-secret-inheritance"
              },
              {
                "kind": "Addon",
                "spec": {
                  "externalAccessEnabled": false,
                  "type": "redis",
                  "billing": {
                    "replicas": 1,
                    "storage": 4096,
                    "storageClass": "ssd",
                    "deploymentPlan": "nf-compute-10"
                  },
                  "tlsEnabled": true,
                  "infrastructure": {
                    "architecture": "x86"
                  },
                  "typeSpecificSettings": {
                    "redisSentinelEnabled": false
                  },
                  "name": "harvest-mcp-redis-prd",
                  "version": "7.2.4"
                },
                "ref": "harvest-mcp-redis-prd"
              },
              {
                "kind": "SecretGroup",
                "spec": {
                  "type": "secret",
                  "secretType": "environment",
                  "priority": 10,
                  "secrets": {
                    "variables": "${refs.harvest-mcp-secret-inheritance.values}",
                    "files": {},
                    "dockerSecretMounts": {}
                  },
                  "addonDependencies": [],
                  "name": "harvest-mcp-secrets-prd",
                  "restrictions": {
                    "restricted": false,
                    "nfObjects": [],
                    "tags": []
                  }
                },
                "ref": "harvest-mcp-secrets-prd"
              },
              {
                "kind": "CombinedService",
                "spec": {
                  "deployment": {
                    "instances": 1,
                    "storage": {
                      "ephemeralStorage": {
                        "storageSize": 1024
                      },
                      "shmSize": 64
                    },
                    "docker": {
                      "configType": "default"
                    }
                  },
                  "loadBalancing": {
                    "mode": "leastConnection"
                  },
                  "buildSettings": {
                    "storage": {
                      "ephemeralStorage": {
                        "storageSize": 16384
                      }
                    },
                    "dockerfile": {
                      "buildEngine": "buildkit",
                      "dockerWorkDir": "/",
                      "dockerFilePath": "/Dockerfile",
                      "buildkit": {
                        "useCache": false,
                        "cacheStorageSize": 16384
                      }
                    }
                  },
                  "billing": {
                    "deploymentPlan": "unbounded-300m",
                    "buildPlan": "nf-compute-400-16"
                  },
                  "runtimeEnvironment": {},
                  "runtimeFiles": {},
                  "buildArguments": {},
                  "buildFiles": {},
                  "dockerSecretMounts": {},
                  "infrastructure": {
                    "architecture": "x86"
                  },
                  "name": "harvest-mcp-prd",
                  "vcsData": {
                    "projectType": "github",
                    "accountLogin": "swalberg",
                    "projectUrl": "https://github.com/swalberg/harvest-mcp-server",
                    "projectBranch": "main"
                  },
                  "ports": [
                    {
                      "internalPort": 3000,
                      "protocol": "HTTP",
                      "name": "p01",
                      "public": true,
                      "domains": [],
                      "security": {
                        "policies": [],
                        "credentials": []
                      },
                      "disableNfDomain": false
                    }
                  ],
                  "disabledCI": false,
                  "buildConfiguration": {
                    "pathIgnoreRules": [],
                    "isAllowList": false,
                    "ciIgnoreFlagsEnabled": false
                  },
                  "healthChecks": [
                    {
                      "type": "readinessProbe",
                      "protocol": "HTTP",
                      "path": "/health",
                      "port": 3000,
                      "initialDelaySeconds": 5,
                      "periodSeconds": 60,
                      "timeoutSeconds": 10,
                      "failureThreshold": 3,
                      "successThreshold": 1
                    },
                    {
                      "type": "livenessProbe",
                      "protocol": "HTTP",
                      "path": "/health",
                      "port": 3000,
                      "initialDelaySeconds": 5,
                      "periodSeconds": 60,
                      "timeoutSeconds": 10,
                      "failureThreshold": 3
                    }
                  ]
                },
                "ref": "harvest-mcp-prd"
              },
              {
                "kind": "SecretGroup",
                "spec": {
                  "type": "secret",
                  "secretType": "environment",
                  "priority": 10,
                  "secrets": {
                    "variables": {
                      "OAUTH_REDIRECT_URI": "https://${refs.harvest-mcp-prd.ports.0.dns}/auth/callback",
                      "PORT": "3000",
                      "NODE_ENV": "production",
                      "STANDARD_WORK_DAY_HOURS": "8",
                      "TIMEZONE": "America/New_York",
                      "LOG_LEVEL": "debug",
                      "SERVER_BASE_URL": "https://${refs.harvest-mcp-prd.ports.0.dns}"
                    },
                    "files": {},
                    "dockerSecretMounts": {}
                  },
                  "addonDependencies": [
                    {
                      "addonId": "${refs.harvest-mcp-redis-prd.id}",
                      "keys": [
                        {
                          "keyName": "REDIS_MASTER_URL",
                          "aliases": [
                            "REDIS_URL"
                          ]
                        }
                      ]
                    }
                  ],
                  "name": "harvest-mcp-config-prd",
                  "restrictions": {
                    "restricted": false,
                    "nfObjects": [],
                    "tags": []
                  }
                },
                "ref": "harvest-mcp-config-prd"
              }
            ]
          }
        }
      ]
    }
  },
  "name": "harvest-mcp-prd",
  "description": "",
  "options": {
    "autorun": false,
    "concurrencyPolicy": "allow"
  },
  "gitops": {
    "repoUrl": "https://github.com/swalberg/harvest-mcp-server",
    "vcsService": "github",
    "accountLogin": "swalberg",
    "branch": "main",
    "filePath": "/northflank.json"
  },
  "$schema": "https://api.northflank.com/v1/schemas/template"
}